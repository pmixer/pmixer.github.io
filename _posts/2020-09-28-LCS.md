---
category: 'basics'
title: 'æœ€é•¿ä¸Šå‡(é€’å¢)å­åºåˆ—'
note: 'å¤§å‚å›æ—è‡ªæ²»å¿æ¬¢è¿æ‚¨:)'
---

# é¢˜ç›®

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œæ±‚å…¶å•è°ƒé€’å¢çš„å­åºåˆ—(subsequence)çš„æœ€å¤§é•¿åº¦ã€‚

# æ€è·¯

æ­¤å¤„å­åºåˆ—å¯ç†è§£ä¸ºé€»è¾‘ä¸Šä»åŸæ•°ç»„ç­›å‡ºä»»æ„ä¸ªå…ƒç´ å¹¶æŒ‰ç…§å…¶åœ¨åŸæ•°ç»„ä¸­çš„å‡ºç°é¡ºåºæ’åˆ—è€Œæˆçš„æ–°æ•°ç»„ï¼Œæ³¨æ„å…¶ä¸å­—ä¸²(substring)æ¦‚å¿µä¸åŒã€‚è‹¥é‡‡ç”¨æšä¸¾æ–¹æ³•ï¼Œå­åºåˆ—çš„ä¸ªæ•°éšè¾“å…¥æ•°ç»„å…ƒç´ ä¸ªæ•°å‘ˆæŒ‡æ•°å¢é•¿ï¼Œæ— æ³•æš´åŠ›æšä¸¾è§£é¢˜ã€‚

æ­¤å¤„è€ƒè™‘ä½¿ç”¨åŠ¨æ€è§„åˆ’(DP)æ–¹æ³•ï¼Œå‚è€ƒ [DPVç®—æ³•ä¹¦](http://algorithmics.lsi.upc.edu/docs/Dasgupta-Papadimitriou-Vazirani.pdf "Dasgupta S, Papadimitriou C H, Vazirani U V. Algorithms[M]. New York: McGraw-Hill Higher Education, 2008.") åŠç›¸åº”[æ•™å­¦è§†é¢‘](https://classroom.udacity.com/courses/ud401 "Gatech CS6515 Course")ï¼Œå°†å…ƒç´ é—´çš„å°äºå…³ç³»ä»¥æœ‰å‘è¾¹çš„å½¢å¼ç»™å‡ºï¼Œè¯¥é—®é¢˜è½¬åŒ–ä¸ºæ±‚å¯¹åº”æœ‰å‘æ— ç¯å›¾(DAG)çš„ç›´å¾„(diameter, å³æœ€é•¿è·¯å¾„é•¿åº¦)ã€‚

æˆ‘ä»¬åªéœ€è¦ç»´æŠ¤ä¸€ä¸ªåˆå§‹ä¸ºç©ºçš„é€’å¢æ•°ç»„ï¼Œä»å¤´åˆ°å°¾éå†è¾“å…¥æ•°ç»„çš„å…ƒç´ ï¼Œå½“é€’å¢æ•°ç»„ä¸ºç©ºæˆ–æ–°å…ƒç´ å¤§äºå…¶å°¾éƒ¨å…ƒç´ æ—¶ï¼Œç›´æ¥å°†å…¶å‹å…¥é€’å¢æ•°ç»„ï¼Œå¦åˆ™å¯»æ‰¾é€’å¢æ•°ç»„ä¸­ä¸å°äºè¯¥å…ƒç´ çš„æœ€å°å…ƒç´ å¹¶è¿›è¡Œæ›¿æ¢ã€‚æœ€åè¾“å‡ºé€’å¢æ•°ç»„é•¿åº¦å³å¯ã€‚æ•´ä½“æ—¶é—´å¤æ‚åº¦ O(nlog(n))ï¼Œåˆ†åˆ«å¯¹åº”äºçº¿æ€§éå†çš„æ­¥æ•°å’ŒäºŒåˆ†æŸ¥æ‰¾çš„è€—æ—¶ã€‚

è¯¥æ–¹æ³•çš„æœ¬è´¨æ˜¯è®°å½•å½“å‰æ‰€æœ‰é•¿åº¦ä¸º k çš„é€’å¢å­åºåˆ—ä¸­çš„æœ€å¤§å…ƒç´ çš„æœ€å°å€¼(å³æ„æˆ k+1 é•¿åº¦é€’å¢å­åºåˆ—çš„æœ€ä½é—¨æ§›)ï¼Œè¯¥å€¼å³æˆ‘ä»¬æ‰€ç»´æŠ¤çš„é€’å¢æ•°ç»„çš„ç¬¬ k ä¸ªå…ƒç´ ã€‚åŸºäºè¯¥ä¿¡æ¯ç»§ç»­é‡‡ç”¨è´ªå¿ƒç­–ç•¥ï¼Œå¯¹æ¯ä¸ªæ–°é‡åˆ°çš„å…ƒç´ å°è¯•æ„é€ ä»¥å…¶ä¸ºæœ€å¤§å…ƒç´ çš„æœ€é•¿é€’å¢å­åºåˆ—(å³å¯»æ‰¾é¦–ä¸ªå°äºè‡ªå·±çš„â€œé•¿åº¦ä¸º k çš„é€’å¢å­åºåˆ—ä¸­çš„æœ€å¤§å…ƒç´ çš„æœ€å°å€¼â€å¯¹åº”çš„ k)ï¼Œå¹¶æ›´æ–°é•¿åº¦ä¸º k+1 çš„é€’å¢å­åºåˆ—ä¸­çš„æœ€å¤§å…ƒç´ çš„æœ€å°å€¼ã€‚(hhhhhï¼Œå¥½æ‹—å£ï¼Œä¸‹æ¬¡è¯•è¯•èƒ½ä¸èƒ½æ’å…¥æ•°å­¦å…¬å¼)ã€‚

# ä»£ç 

å»ºè®®ä½¿ç”¨å¾®ä¿¡ç”µè„‘å®¢æˆ·ç«¯é˜…è¯»:

```cpp
class Solution {
public:
    int lengthOfLIS(vector<int>& nums) {
        // hinted by 6515 course textbook
        // its actually finding dag's diameter
        std::vector<int> rank2max;
        
        for (auto num:nums) {
            if (rank2max.empty() || num > rank2max.back()) {
                rank2max.push_back(num);
            } else {
                auto it = std::upper_bound(rank2max.begin(), rank2max.end(), num-1);
                *it = num;
            }
        }
        
        return rank2max.size();
    }
};
```

# ç»ƒä¹ 

ç¼–ç¨‹é¢˜:

[LeetCode #300](https://leetcode.com/problems/longest-increasing-subsequence/)

ä»£ç é˜…è¯»é¢˜: 

è¯»å†™èƒ½åŠ›ä¸€æ‰‹æŠ“:) è¿™é‡Œç»™ä¸€ä¸ªç¨è¿›é˜¶çš„ç‰ˆæœ¬, è¦æ±‚è®¡ç®—ç»™å®šæ•°ç»„ä¸­å‰åŠæ®µä¸ºå•è°ƒé€’å‡å­åºåˆ—ååŠæ®µä¸ºå•è°ƒé€’å¢å­åºåˆ—ï¼Œä¸¤å­åºåˆ—é•¿åº¦ç›¸åŒä¸”æœ€å°å…ƒç´ ç›¸åŒçš„å­åºåˆ—çš„æœ€å¤§é•¿åº¦ã€‚(åƒè‘¡è„ä¸åè‘¡è„çš®hhhhï¼Œè¯»æ‡‚å°±å¥½, è®°å¾—ç™»ç”µè„‘ç«¯æ¥çœ‹ä»£ç )

```cpp
#include <iostream>
#include <vector>
#include <stack>
#include <algorithm>
/*
testcase:
3
9
5 4 3 2 1 2 3 4 5
5
1 2 3 4 5
14
87 70 17 12 14 86 61 51 12 90 69 89 4 65

8
0
6
*/

void gen_LDC(std::vector<int> &arr, std::vector<int> &LDC, int arr_size) {
    std::vector<int> rank2max4LDC;
    for (int i = 0; i < arr_size; i++) {
        int num = arr[i];

        if (rank2max4LDC.empty() || rank2max4LDC.back() > num) {
            rank2max4LDC.push_back(num);
            LDC[i] = rank2max4LDC.size();
        } else {
            auto it = std::upper_bound(rank2max4LDC.begin(), rank2max4LDC.end(), num+1,
                                        [](const int a, const int b) {return a > b;});
            *it = num;
            LDC[i] = it - rank2max4LDC.begin() + 1;
        }
    }
}

int main() {
    int testcase_num;
    std::cin >> testcase_num;
    while (testcase_num-- > 0) {
        int arr_size;
        std::cin >> arr_size;
        std::vector<int> arr(arr_size);
        std::vector<int> LIC(arr_size, 0);
        std::vector<int> LDC(arr_size, 0);
        for (int i = 0; i < arr_size; i++) {
            std::cin >> arr[i];
        }
        // firstly construct LDC&LIC by DP
        gen_LDC(arr, LDC, arr_size);
        std::reverse(arr.begin(), arr.end());
        gen_LDC(arr, LIC, arr_size);
        std::reverse(arr.begin(), arr.end());
        std::reverse(LIC.begin(), LIC.end());

        // then argsort arr, for each equal region, calc max len.
        std::vector<std::pair<int, int> > val2idx;
        for (int i = 0; i < arr_size; i++) {
            val2idx.push_back(std::make_pair(arr[i], i));
        }
        std::sort(val2idx.begin(), val2idx.end());
        int max_len = 0; // start gen result, use stacks to turn O(N^2) to O(N)
        std::stack<int> LIC_maxlen_on_right; // LDC_maxlen_on_left is useless

        for (int i = 0; i < arr_size - 1;) {
            int j, k;
            for (j = i + 1; j < arr_size; j++) {
                if (val2idx[i].first != val2idx[j].first) { // forget .first
                    j--;
                    break;
                }
            }
            if (j == arr_size) j--;

            k = j;
            if (k > i) {
                LIC_maxlen_on_right.push(LIC[val2idx[k].second]);
                k--;
            }
            while (k > i) {
                int current_max = LIC_maxlen_on_right.top();
                int new_LIC_len = LIC[val2idx[k].second];
                LIC_maxlen_on_right.push(std::max(current_max, new_LIC_len));
                k--;
            }

            int current_max_LDC = LDC[val2idx[i].second];
            for (k = i; k < j; k++) {
                current_max_LDC = std::max(current_max_LDC, LDC[val2idx[k].second]);
                int concat_len = 2 * std::min(current_max_LDC, LIC_maxlen_on_right.top());
                max_len = std::max(max_len, concat_len);
                LIC_maxlen_on_right.pop();
            }
            i = j + 1;
            // LIC_maxlen_on_right.clear // should already be empty
        }

        std::cout << max_len << std::endl;
    }
    return 0;
}
```

# ç§˜ç±

ç»§ç»­æ¨èé‚“å…¬çš„æ•°æ®ç»“æ„ä¸ç®—æ³• MOOC å¤§è®²å ‚ğŸ‘ [æ•°æ®ç»“æ„(ä¸Š)](https://next.xuetangx.com/course/THU08091000384), [æ•°æ®ç»“æ„(ä¸‹)](https://next.xuetangx.com/course/THU08091002048), [THUOJ](https://dsa.cs.tsinghua.edu.cn/oj/), [DSA.WORKSPACE](https://github.com/pmixer/dsa.workspace)ï¼ŒåäºŒé“ç¼–ç¨‹é¢˜åšäº†ä¸åƒäºï¼Œåšäº†ä¸ä¸Šå½“(å°±æ˜¯ä¸èƒ½ç”¨ STL å„ç§ç»“æ„å…¨è¦æ‰‹åŠ¨å®ç° hhhh)
